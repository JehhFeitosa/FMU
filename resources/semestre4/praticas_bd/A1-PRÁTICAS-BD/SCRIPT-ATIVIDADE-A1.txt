USE FMU;

-- CRIAÇÃO DA PROCEDURE
CREATE PROCEDURE SP_ATIVIDADE_A1_FAIXA_SALARIAL_FUNCIONARIO
AS
-- DECLARA AS VARIAVEIS DE AMBIENTE PARA ARMAZENAR E MANIPULAR OS DADOS
DECLARE @INICIO INT = 1, @FINAL INT = 3000, @FIM INT = 30000, @QTD_HOMENS INT, @QTD_MULHERES INT;

-- LOOP PARA NAVEGAR PELA TABELA
WHILE(@INICIO <= @FIM)
	BEGIN
		-- CASO NAO EXISTA UMA TABELA CRIADA NA BASE DE DADOS CHAMADA RELACAO
		IF NOT EXISTS(SELECT * FROM SYSOBJECTS WHERE NAME = 'RELACAO')
			BEGIN
				-- CRIE UMA NOVA TABELA CHAMADA RELACAO
				CREATE TABLE RELACAO(
					ID INT IDENTITY(1,1) NOT NULL,
					INICIO INT NULL,
					FINAL INT NULL,
					MULHERES INT NULL,
					HOMENS INT NULL,

					CONSTRAINT PK_RELACAO PRIMARY KEY(ID)
				)
			END
		ELSE 
			BEGIN
				SELECT @QTD_MULHERES = COUNT(*) FROM FUNCIONARIO WHERE SEXO = 'F' AND SALARIO >= @INICIO AND SALARIO <= @FINAL; -- TRAZ O TOTAL DE MULHERES
				SELECT @QTD_HOMENS = COUNT(*) FROM FUNCIONARIO WHERE SEXO = 'M' AND SALARIO >= @INICIO AND SALARIO <= @FINAL; -- TRAZ O TOTAL DE HOMENS

				-- INSERE OS DADOS ARMAZENADOS NAS VARIAVEIS DENTRO DE CADA POSICAO DA TABELA RELACAO
				INSERT INTO RELACAO(INICIO, FINAL, MULHERES, HOMENS) VALUES (@INICIO, @FINAL, @QTD_MULHERES, @QTD_HOMENS)

				SET @INICIO = @INICIO + 3000; -- INCREMENTA O VALOR DE INICIO
				SET @FINAL = @FINAL + 3000; -- INCREMENTA O VALOR DE FINAL
			END

	END

-- SELECIONANDO A TABELA RELAÇÃO
SELECT * FROM RELACAO;

-- EXECUTANDO A PROCEDURE
EXECUTE SP_ATIVIDADE_A1_FAIXA_SALARIAL_FUNCIONARIO;